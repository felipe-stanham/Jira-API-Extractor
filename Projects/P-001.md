# P-001: Enhanced Epic and Sprint Analytics

## Project Overview

**Goal**: Enhance the Jira API Extractor with epic-level tracking and additional sprint analytics capabilities.

**Timeline**: 6 weeks

**Status**: Ready to start

**Reference**: See `InputDocs/Project-001.md` for detailed requirements and technical approach.

---

## Scope 1: Sprint Sheet Enhancements

**Objective**: Add story points, parent key, and status category columns to sprint sheets for better planning analysis.

### Tasks

- [ ] Add story points field configuration to `config.py`
- [ ] Update `.env.example` with `JIRA_STORY_POINTS_FIELD` parameter
- [ ] Enhance `get_issues_in_sprint()` in `jira_api.py` to fetch story points field
- [ ] Enhance `get_issues_in_sprint()` to fetch parent key field
- [ ] Enhance `get_issues_in_sprint()` to fetch status category field
- [ ] Update sprint sheet headers in `excel_exporter.py` to include new columns
- [ ] Update sprint sheet data writing to include story points
- [ ] Update sprint sheet data writing to include parent key
- [ ] Update sprint sheet data writing to include status category
- [ ] Handle missing story points gracefully (show "N/A")
- [ ] Handle missing parent key gracefully (show "N/A")
- [ ] Test with multiple Jira instances to verify field compatibility
- [ ] Update `docs/database.md` with new sprint sheet columns

---

## Scope 2: Epic Label Filtering

**Objective**: Implement epic filtering by label and create "Epics with Label" sheet.

### Tasks

- [ ] Add `--epic_label` argument to `main.py` CLI
- [ ] Add epic label input field to `streamlit_app.py` GUI
- [ ] Implement `get_epics_by_label()` method in `jira_api.py`
- [ ] Implement `get_issues_in_epic()` method in `jira_api.py`
- [ ] Add pagination support for epic issue fetching
- [ ] Create `_write_epics_with_label_sheet()` method in `excel_exporter.py`
- [ ] Include all sprint sheet columns plus epic status in new sheet
- [ ] Handle case when no epics match the label (empty sheet with warning)
- [ ] Add epic status column to show parent epic status
- [ ] Test with various epic labels
- [ ] Ensure sheet only created when epic_label parameter provided
- [ ] Update `docs/database.md` with Epics with Label sheet schema

---

## Scope 3: Open Epics Sheet

**Objective**: Create "Open Epics" sheet showing all tickets from non-done epics.

### Tasks

- [ ] Implement `get_open_epics()` method in `jira_api.py`
- [ ] Implement logic to fetch all issues from open epics
- [ ] Use status category to determine "open" (not "Done")
- [ ] Create `_write_open_epics_sheet()` method in `excel_exporter.py`
- [ ] Include all sprint sheet columns plus epic status
- [ ] Add epic status column showing parent epic status
- [ ] Ensure sheet always created (not conditional like epic label sheet)
- [ ] Handle large result sets with pagination
- [ ] Test with projects having many open epics
- [ ] Update `docs/database.md` with Open Epics sheet schema

---

## Scope 4: Charts for Epic Sheets

**Objective**: Add visual analytics for epic-based sheets.

### Tasks

- [ ] Add status distribution pie chart for "Epics with Label" sheet
- [ ] Add type distribution pie chart for "Epics with Label" sheet
- [ ] Add status distribution pie chart for "Open Epics" sheet
- [ ] Add type distribution pie chart for "Open Epics" sheet
- [ ] Position charts properly to avoid overlap
- [ ] Apply consistent color scheme from `chart_colors.py`
- [ ] Add summary statistics for epic sheets (total issues, total story points)
- [ ] Test chart generation with various data sizes
- [ ] Update `charts_helper_enhanced.py` with new chart methods

---

## Scope 5: Testing & Documentation

**Objective**: Ensure quality, update documentation, and verify all functionality.

### Tasks

- [ ] Integration test: Sprint enhancements only
- [ ] Integration test: Epic label filtering only
- [ ] Integration test: Open epics only
- [ ] Integration test: All features combined
- [ ] Integration test: Backward compatibility (existing features still work)
- [ ] Test with missing data (no story points, no parent)
- [ ] Test with large datasets (100+ issues per epic)
- [ ] Test with multiple epic labels (edge cases)
- [ ] Update `README.md` with new parameters and features
- [ ] Update `docs/architecture.md` with new components and data flows
- [ ] Update `docs/database.md` with all new sheet schemas (completed in scopes 1-3)
- [ ] Add examples to README for new usage patterns
- [ ] Update `Lessons.md` with any new learnings
- [ ] Create user documentation for epic filtering feature
- [ ] Performance testing and optimization if needed

---

## Next Steps

1. **Start with Scope 1**: Sprint Sheet Enhancements (foundational changes)
2. **Proceed to Scope 2**: Epic Label Filtering (new feature)
3. **Continue to Scope 3**: Open Epics Sheet (new feature)
4. **Add Scope 4**: Charts for Epic Sheets (analytics)
5. **Complete with Scope 5**: Testing & Documentation (quality assurance)

**Current Focus**: Ready to begin Scope 1 - Sprint Sheet Enhancements

---

## Notes

### Configuration Requirements
- Story points field varies by Jira instance (common: `customfield_10016`, `customfield_10026`)
- Default to `customfield_10016` if not specified
- User can override in `.env` file

### API Endpoints to Use
- `/rest/api/3/issue/{issueKey}` - Enhanced with story points, parent, status category fields
- `/rest/api/3/search/jql` - For epic filtering: `type=Epic AND labels="{label}"`
- `/rest/api/3/search/jql` - For open epics: `type=Epic AND statusCategory!=Done`
- `/rest/api/3/search/jql` - For epic issues: `parent={epic_key}`

### Performance Considerations
- Use existing pagination mechanism from `utils.py`
- Cache epic details to avoid redundant API calls
- Batch process when possible
- Add progress indicators in GUI for long operations

### Backward Compatibility
- All existing functionality must continue to work
- New parameters are optional
- Existing exports should be unchanged when new features not used

---

## Success Metrics

- ✅ All sprint sheets include 3 new columns (Story Points, Parent Key, Status Category)
- ✅ Epic label filtering works with any valid label
- ✅ Open Epics sheet always generated and shows current open work
- ✅ Charts provide visual insights for epic-based sheets
- ✅ No breaking changes to existing functionality
- ✅ Performance: < 30 seconds for 100 issues per epic
- ✅ Documentation complete and up-to-date
- ✅ All tests passing

---

## Risks Being Monitored

1. **Story Points Field Variation** - Mitigated with configuration option
2. **Large Epic Performance** - Mitigated with pagination and progress indicators
3. **Epic Label Not Found** - Mitigated with clear error messages
4. **Status Category Non-Standard** - Mitigated by using Jira's built-in field
5. **Performance Degradation** - Mitigated with batch calls and caching

---

## Questions Resolved

1. ✅ **Story Points Field**: Use configuration with common defaults
2. ✅ **Epic Label Input**: Single label for MVP
3. ✅ **Sheet Naming**: "Epics with Label [{label_name}]" and "Open Epics"
4. ✅ **Empty Results**: Create empty sheet with headers and show warning
5. ✅ **Charts**: Add basic charts similar to sprint sheets
