# P-002: Progress Graphs

## Project Overview

**Goal**: Add comprehensive progress visualization charts to help users track sprint and epic completion.

**Timeline**: 4 weeks

**Status**: ðŸ“‹ Planning - Design Approved

**Reference**: See `InputDocs/Project-002.md` for detailed requirements.

---

## Design Decisions

### Approved Design Choices

1. **Multiple Sprints**: Create separate chart sets per sprint (Option A)
2. **Epic Sorting**: Sort by completion percentage, highest first (Option B)
3. **Zero Story Points**: Exclude from charts entirely (Option A)
4. **Chart Readability**: Show all epics, no limit (Option A)
5. **Epic Naming**: Truncate long names with ellipsis (Option D)
6. **Sprint Composition**: Show total story points per epic (Option A)
7. **Conditional Charts**: Epic Label charts only when `--epic_label` provided
8. **Data Source**: Use source data, maintain consistency with sheets (Option B)
9. **Stacked Bar Order**: Done â†’ In Progress â†’ To Do (left to right) (Option A)
10. **Missing Parent**: Group as "No Epic" or "Unassigned" (Option A)

---

## Scope 1: Data Aggregation & Helper Functions

**Objective**: Create reusable data aggregation functions for chart generation (FOUNDATION).

### Tasks

- [ ] Create `calculate_epic_progress()` function
  - Input: List of issues
  - Output: Dict with epic key, name, done points, in progress points, to do points, total points, percentage
  - Exclude epics with 0 total story points
  - Sort by completion percentage (highest first)
- [ ] Create `aggregate_by_epic()` function
  - Groups issues by parent epic key
  - Handles "No Epic" group for issues without parent
  - Returns structured data for chart creation
  - Truncate epic names longer than 40 characters with "..."
- [ ] Create `calculate_sprint_composition()` function
  - Calculates total story points per epic in sprint
  - Returns data for pie chart (epic distribution)
  - Excludes epics with 0 story points
- [ ] Create `filter_issues_by_sheet()` function
  - Filters issues from specific sheet data
  - Handles different sheet structures
  - Maintains consistency with sheet data
- [ ] Add error handling for missing data
- [ ] Add validation for story points (handle 0 values, exclude from charts)
- [ ] Add epic name truncation utility (max 40 chars + "...")
- [ ] Create unit tests for aggregation functions
- [ ] Test with "No Epic" scenarios
- [ ] Test sorting by completion percentage

---

## Scope 2: Sprint Progress Charts

**Objective**: Create progress charts for sprint data showing epic completion by percentage and story points.

### Tasks

#### Chart 1: Sprint Progress in Percentage (per sprint)
- [ ] Use `calculate_epic_progress()` from Scope 1
- [ ] Create one chart per sprint (if multiple sprints)
- [ ] Sort epics by completion percentage (highest first)
- [ ] Create horizontal bar chart with truncated epic names on Y-axis
- [ ] Set percentage (0-100%) on X-axis
- [ ] Apply color scheme for progress bars
- [ ] Exclude epics with 0 total story points
- [ ] Include "No Epic" group if issues without parent exist
- [ ] Add chart title: "Sprint [name] - Progress by Epic (%)"

#### Chart 2: Sprint Progress in Story Points (Stacked, per sprint)
- [ ] Use `calculate_epic_progress()` from Scope 1
- [ ] Create one chart per sprint (if multiple sprints)
- [ ] Sort epics by completion percentage (highest first)
- [ ] Create horizontal stacked bar chart
- [ ] Add three series in order: Done (left, green) â†’ In Progress (middle, yellow) â†’ To Do (right, blue)
- [ ] Set truncated epic names on Y-axis
- [ ] Set story points on X-axis
- [ ] Exclude epics with 0 total story points
- [ ] Include "No Epic" group if issues without parent exist
- [ ] Add data labels showing values for each section
- [ ] Add chart title: "Sprint [name] - Progress by Epic (Story Points)"

#### Chart 3: Sprint Composition (Pie Chart, per sprint)
- [ ] Use `calculate_sprint_composition()` from Scope 1
- [ ] Create one pie chart per sprint (if multiple sprints)
- [ ] Calculate total story points per epic (all statuses)
- [ ] Calculate percentage per epic (epic total / sprint total * 100)
- [ ] Create pie chart with epic slices
- [ ] Add truncated epic names as labels
- [ ] Show percentage and story points in labels
- [ ] Apply distinct color per epic slice
- [ ] Exclude epics with 0 total story points
- [ ] Include "No Epic" slice if issues without parent exist
- [ ] Add chart title: "Sprint [name] - Composition by Epic"

---

## Scope 3: Epic Label Progress Charts (CONDITIONAL)

**Objective**: Create progress charts for "Epics with Label" sheet showing epic completion.

**Note**: These charts are only created when `--epic_label` parameter is provided.

### Tasks

#### Chart 4: Epic Progress in Percentage
- [ ] Use `calculate_epic_progress()` from Scope 1
- [ ] Filter data from "Epics with Label" source data
- [ ] Sort epics by completion percentage (highest first)
- [ ] Create horizontal bar chart with truncated epic names on Y-axis
- [ ] Set percentage (0-100%) on X-axis
- [ ] Exclude epics with 0 total story points
- [ ] Include "No Epic" group if issues without parent exist
- [ ] Add chart title: "Epic Label Progress by Epic (%)"
- [ ] Only create when `--epic_label` provided

#### Chart 5: Epic Progress in Story Points (Stacked)
- [ ] Use `calculate_epic_progress()` from Scope 1
- [ ] Filter data from "Epics with Label" source data
- [ ] Sort epics by completion percentage (highest first)
- [ ] Create horizontal stacked bar chart
- [ ] Add three series in order: Done (left, green) â†’ In Progress (middle, yellow) â†’ To Do (right, blue)
- [ ] Set truncated epic names on Y-axis
- [ ] Set story points on X-axis
- [ ] Exclude epics with 0 total story points
- [ ] Include "No Epic" group if issues without parent exist
- [ ] Add data labels showing values for each section
- [ ] Add chart title: "Epic Label Progress by Epic (Story Points)"
- [ ] Only create when `--epic_label` provided

---

## Scope 4: Open Epic Progress Charts

**Objective**: Create progress charts for "Open Epics" sheet showing current work status.

### Tasks

#### Chart 6: Open Epic Progress in Percentage
- [ ] Use `calculate_epic_progress()` from Scope 1
- [ ] Filter data from "Open Epics" source data
- [ ] Sort epics by completion percentage (highest first)
- [ ] Create horizontal bar chart with truncated epic names on Y-axis
- [ ] Set percentage (0-100%) on X-axis
- [ ] Exclude epics with 0 total story points
- [ ] Include "No Epic" group if issues without parent exist
- [ ] Add chart title: "Open Epics Progress by Epic (%)"
- [ ] Handle large number of open epics (show all)

#### Chart 7: Open Epic Progress in Story Points (Stacked)
- [ ] Use `calculate_epic_progress()` from Scope 1
- [ ] Filter data from "Open Epics" source data
- [ ] Sort epics by completion percentage (highest first)
- [ ] Create horizontal stacked bar chart
- [ ] Add three series in order: Done (left, green) â†’ In Progress (middle, yellow) â†’ To Do (right, blue)
- [ ] Set truncated epic names on Y-axis
- [ ] Set story points on X-axis
- [ ] Exclude epics with 0 total story points
- [ ] Include "No Epic" group if issues without parent exist
- [ ] Add data labels showing values for each section
- [ ] Add chart title: "Open Epics Progress by Epic (Story Points)"
- [ ] Handle large number of open epics (show all)

---

## Scope 5: Chart Styling & Formatting

**Objective**: Ensure consistent, professional chart styling across all progress charts.

### Tasks

- [ ] Define color scheme for progress states:
  - Done: Green (#4CAF50)
  - In Progress: Yellow (#FFC107)
  - To Do: Blue (#2196F3)
- [ ] Define color palette for epic differentiation (pie charts)
- [ ] Set consistent chart dimensions
- [ ] Configure axis labels and titles
- [ ] Set data label formats (percentage, story points)
- [ ] Configure legend positioning
- [ ] Set chart borders and gridlines
- [ ] Ensure readability (font sizes, spacing)
- [ ] Test with different data volumes (few vs many epics)
- [ ] Apply truncation to epic names (max 40 chars + "...")
- [ ] Ensure consistency across all 7 chart types

---

## Scope 6: Progress Sheet Creation & Integration

**Objective**: Create dedicated "Progress" sheet and integrate all charts with proper layout.

### Tasks

- [ ] Create new "Progress" sheet in Excel workbook
- [ ] Design chart layout to avoid overlaps
- [ ] Calculate chart positions based on number of sprints
- [ ] For each sprint, position 3 charts (%, story points, composition)
- [ ] Position Chart 4-5 (Epic Label charts) - only if `--epic_label` provided
- [ ] Position Chart 6-7 (Open Epic charts)
- [ ] Add sheet title and descriptions
- [ ] Handle multiple sprints (create 3 charts per sprint)
- [ ] Ensure conditional chart creation (epic label charts)
- [ ] Add spacing between chart groups
- [ ] Maintain consistency with source data in sheets
- [ ] Test layout with 1, 2, and 3+ sprints

---

## Scope 7: Testing & Documentation

**Objective**: Ensure quality, update documentation, and verify all functionality.

### Tasks

- [ ] Test with single sprint
- [ ] Test with multiple sprints (2, 3+ sprints)
- [ ] Test with epic label filtering
- [ ] Test with no epic label (conditional charts not created)
- [ ] Test with open epics only
- [ ] Test with missing story points (0 values excluded)
- [ ] Test with epics having no issues
- [ ] Test with large datasets (20+ epics)
- [ ] Test with "No Epic" scenarios (issues without parent)
- [ ] Test epic name truncation (long names)
- [ ] Test sorting by completion percentage
- [ ] Verify data consistency between charts and sheets
- [ ] Update `README.md` with new Progress sheet
- [ ] Update `docs/database.md` with Progress sheet schema
- [ ] Update `docs/architecture.md` with chart generation flow
- [ ] Add examples to README for progress charts
- [ ] Update `Lessons.md` with new learnings
- [ ] Create user documentation for interpreting charts
- [ ] Performance testing with large datasets

---

## Technical Approach

### Data Flow
1. **Aggregate Data**: Use Scope 1 functions to group by epic, calculate story points by status category
2. **Extract Issues**: From Sprint/Epic Label/Open Epic source data (not Excel sheets)
3. **Generate Charts**: Create openpyxl chart objects with aggregated data
4. **Position Charts**: Layout charts in Progress sheet with proper spacing
5. **Export**: Include Progress sheet in final Excel workbook
6. **Verify Consistency**: Ensure chart data matches sheet data

### Key Considerations
- **Data Source**: Use source data (issues lists), not Excel sheets, to maintain consistency
- **Conditional Charts**: Epic Label charts only created when `--epic_label` provided
- **Multiple Sprints**: Create separate chart sets per sprint (3 charts per sprint)
- **Zero Story Points**: Exclude epics with 0 total story points from all charts
- **Epic Naming**: Truncate epic names to 40 chars + "..." for readability
- **Missing Parent**: Group issues without parent as "No Epic" or "Unassigned"
- **Sorting**: Sort epics by completion percentage (highest first) in all bar charts
- **Stacked Bar Order**: Done (left, green) â†’ In Progress (middle, yellow) â†’ To Do (right, blue)
- **Chart Limits**: Show all epics (no pagination), openpyxl can handle large charts
- **Color Consistency**: Reuse color scheme from existing charts

### Files to Modify
- `excel_exporter.py`: Add `_create_progress_sheet()` method
- `charts_helper_enhanced.py`: Add progress chart creation functions
- `main.py`: Ensure progress sheet creation in export flow
- `chart_colors.py`: Add progress state colors

---

## Success Criteria

âœ… Progress sheet created with 7 charts (3 conditional)
âœ… Charts accurately reflect story point progress
âœ… Stacked bars show Done/In Progress/To Do breakdown
âœ… Pie charts show sprint composition by epic
âœ… Charts handle edge cases (no data, 0 points)
âœ… Consistent styling with existing charts
âœ… Documentation updated
âœ… All tests passing

---

## Notes

### Chart Numbering
The specification has duplicate numbering (two "4" and two "5"). The actual 7 charts are:
1. Sprint Progress in Percentage (per sprint)
2. Sprint Progress in Story Points - Stacked (per sprint)
3. Sprint Composition - Pie (per sprint)
4. Epic Label Progress in Percentage (conditional)
5. Epic Label Progress in Story Points - Stacked (conditional)
6. Open Epic Progress in Percentage
7. Open Epic Progress in Story Points - Stacked

**Note**: For multiple sprints, charts 1-3 are created per sprint, resulting in 3N charts where N = number of sprints.

---

## Dependencies

- P-001 must be completed (provides story points, status category, parent key)
- Existing chart infrastructure (charts_helper_enhanced.py)
- openpyxl library for chart creation
- Story points data must be available and accurate

---

## Risk Assessment

**Low Risk:**
- Reusing existing chart infrastructure
- Data already available from P-001
- Similar to existing chart functionality

**Medium Risk:**
- Stacked bar charts may be complex in openpyxl
- Layout with 7 charts may require careful positioning
- Performance with large datasets (many epics)

**Mitigation:**
- Test stacked bar charts early
- Design flexible layout system
- Add pagination/filtering for large epic lists
- Implement efficient data aggregation

---

## Estimated Effort

- **Scope 1**: 3 days (data aggregation & helper functions - FOUNDATION)
- **Scope 2**: 1 week (3 sprint charts, multiple sprint handling)
- **Scope 3**: 2 days (2 epic label charts, conditional logic)
- **Scope 4**: 2 days (2 open epic charts, reuse logic)
- **Scope 5**: 2 days (styling, consistency across 7 chart types)
- **Scope 6**: 3 days (sheet creation, layout, positioning)
- **Scope 7**: 3 days (testing, documentation)

**Total**: ~3.5 weeks

---

## Next Steps

1. âœ… Review and approve plan - **APPROVED**
2. âœ… Clarify design decisions - **ALL ANSWERED**
3. Start with Scope 1 (data aggregation functions - FOUNDATION)
4. Proceed to Scope 2 (sprint charts)
5. Continue with Scope 3 (epic label charts)
6. Continue with Scope 4 (open epic charts)
7. Apply Scope 5 (styling & formatting)
8. Integrate with Scope 6 (sheet creation & layout)
9. Complete with Scope 7 (testing & documentation)

**Ready to start implementation!** ðŸš€
