# P-002: Progress Graphs

## Project Overview

**Goal**: Add comprehensive progress visualization charts to help users track sprint and epic completion.

**Timeline**: 4 weeks

**Status**: ðŸ“‹ Planning

**Reference**: See `InputDocs/Project-002.md` for detailed requirements.

---

## Scope 1: Sprint Progress Charts

**Objective**: Create progress charts for sprint data showing epic completion by percentage and story points.

### Tasks

#### Chart 1: Sprint Progress in Percentage
- [ ] Create data aggregation function to calculate epic completion percentages
- [ ] Group issues by parent epic key
- [ ] Calculate done story points per epic (status category = "Done")
- [ ] Calculate total story points per epic
- [ ] Calculate percentage (done / total * 100)
- [ ] Create horizontal bar chart with epic names on Y-axis
- [ ] Set percentage (0-100%) on X-axis
- [ ] Apply color scheme for progress bars
- [ ] Handle edge cases (no story points, no epics)

#### Chart 2: Sprint Progress in Story Points (Stacked)
- [ ] Create data aggregation function for stacked bar data
- [ ] Calculate "Done" story points per epic
- [ ] Calculate "In Progress" story points per epic
- [ ] Calculate "To Do" story points per epic
- [ ] Create horizontal stacked bar chart
- [ ] Add three series: Done (green), In Progress (yellow), To Do (blue)
- [ ] Set epic names on Y-axis
- [ ] Set story points on X-axis
- [ ] Apply consistent color scheme
- [ ] Add data labels showing values

#### Chart 3: Sprint Composition (Pie Chart)
- [ ] Calculate total story points per sprint
- [ ] Calculate story points per epic within sprint
- [ ] Calculate percentage per epic (epic points / total points * 100)
- [ ] Create pie chart with epic slices
- [ ] Add epic names as labels
- [ ] Show percentage and story points in labels
- [ ] Apply color scheme per epic
- [ ] Handle sprints with no epics

---

## Scope 2: Epic Label Progress Charts

**Objective**: Create progress charts for "Epics with Label" sheet showing epic completion.

### Tasks

#### Chart 4: Epic Progress in Percentage
- [ ] Reuse data aggregation logic from Scope 1
- [ ] Filter data from "Epics with Label" sheet
- [ ] Calculate completion percentage per epic
- [ ] Create horizontal bar chart
- [ ] Set epic names on Y-axis
- [ ] Set percentage (0-100%) on X-axis
- [ ] Apply consistent styling with sprint charts
- [ ] Handle conditional sheet (only when epic_label provided)

#### Chart 5: Epic Progress in Story Points (Stacked)
- [ ] Reuse stacked bar logic from Scope 1
- [ ] Filter data from "Epics with Label" sheet
- [ ] Calculate Done/In Progress/To Do per epic
- [ ] Create horizontal stacked bar chart
- [ ] Apply three-color scheme (Done/In Progress/To Do)
- [ ] Add data labels
- [ ] Handle conditional sheet creation

---

## Scope 3: Open Epic Progress Charts

**Objective**: Create progress charts for "Open Epics" sheet showing current work status.

### Tasks

#### Chart 6: Open Epic Progress in Percentage
- [ ] Reuse data aggregation logic from Scope 1
- [ ] Filter data from "Open Epics" sheet
- [ ] Calculate completion percentage per epic
- [ ] Create horizontal bar chart
- [ ] Set epic names on Y-axis
- [ ] Set percentage (0-100%) on X-axis
- [ ] Apply consistent styling
- [ ] Sort epics by completion percentage (optional)

#### Chart 7: Open Epic Progress in Story Points (Stacked)
- [ ] Reuse stacked bar logic from Scope 1
- [ ] Filter data from "Open Epics" sheet
- [ ] Calculate Done/In Progress/To Do per epic
- [ ] Create horizontal stacked bar chart
- [ ] Apply three-color scheme
- [ ] Add data labels
- [ ] Handle large number of open epics (pagination/filtering)

---

## Scope 4: Progress Sheet Creation & Integration

**Objective**: Create dedicated "Progress" sheet and integrate all charts with proper layout.

### Tasks

- [ ] Create new "Progress" sheet in Excel workbook
- [ ] Design chart layout to avoid overlaps
- [ ] Position Chart 1 (Sprint % Progress)
- [ ] Position Chart 2 (Sprint Story Points Progress)
- [ ] Position Chart 3 (Sprint Composition)
- [ ] Position Chart 4 (Epic Label % Progress) - conditional
- [ ] Position Chart 5 (Epic Label Story Points Progress) - conditional
- [ ] Position Chart 6 (Open Epic % Progress)
- [ ] Position Chart 7 (Open Epic Story Points Progress)
- [ ] Add sheet title and descriptions
- [ ] Handle multiple sprints (create charts per sprint)
- [ ] Ensure conditional chart creation (epic label charts)

---

## Scope 5: Data Aggregation & Helper Functions

**Objective**: Create reusable data aggregation functions for chart generation.

### Tasks

- [ ] Create `calculate_epic_progress()` function
  - Input: List of issues
  - Output: Dict with epic key, name, done points, in progress points, to do points, total points, percentage
- [ ] Create `aggregate_by_epic()` function
  - Groups issues by parent epic key
  - Returns structured data for chart creation
- [ ] Create `calculate_sprint_composition()` function
  - Calculates story points per epic in sprint
  - Returns data for pie chart
- [ ] Create `filter_issues_by_sheet()` function
  - Filters issues from specific sheet data
  - Handles different sheet structures
- [ ] Add error handling for missing data
- [ ] Add validation for story points (handle 0 values)
- [ ] Create unit tests for aggregation functions

---

## Scope 6: Chart Styling & Formatting

**Objective**: Ensure consistent, professional chart styling across all progress charts.

### Tasks

- [ ] Define color scheme for progress states:
  - Done: Green (#4CAF50)
  - In Progress: Yellow (#FFC107)
  - To Do: Blue (#2196F3)
- [ ] Define color palette for epic differentiation
- [ ] Set consistent chart dimensions
- [ ] Configure axis labels and titles
- [ ] Set data label formats (percentage, story points)
- [ ] Configure legend positioning
- [ ] Set chart borders and gridlines
- [ ] Ensure readability (font sizes, spacing)
- [ ] Test with different data volumes (few vs many epics)

---

## Scope 7: Testing & Documentation

**Objective**: Ensure quality, update documentation, and verify all functionality.

### Tasks

- [ ] Test with single sprint
- [ ] Test with multiple sprints
- [ ] Test with epic label filtering
- [ ] Test with no epic label (conditional charts)
- [ ] Test with open epics only
- [ ] Test with missing story points (0 values)
- [ ] Test with epics having no issues
- [ ] Test with large datasets (20+ epics)
- [ ] Update `README.md` with new Progress sheet
- [ ] Update `docs/database.md` with Progress sheet schema
- [ ] Update `docs/architecture.md` with chart generation flow
- [ ] Add examples to README for progress charts
- [ ] Update `Lessons.md` with new learnings
- [ ] Create user documentation for interpreting charts
- [ ] Performance testing with large datasets

---

## Technical Approach

### Data Flow
1. **Extract Issues**: From Sprint/Epic Label/Open Epic sheets
2. **Aggregate Data**: Group by epic, calculate story points by status category
3. **Generate Charts**: Create openpyxl chart objects with aggregated data
4. **Position Charts**: Layout charts in Progress sheet with proper spacing
5. **Export**: Include Progress sheet in final Excel workbook

### Key Considerations
- **Conditional Charts**: Epic Label charts only created when `--epic_label` provided
- **Multiple Sprints**: Create separate chart sets per sprint (or combined view)
- **Zero Story Points**: Handle issues with 0 story points gracefully
- **Epic Naming**: Use parent summary for epic names (fallback to parent key)
- **Chart Limits**: openpyxl may have limits on chart complexity
- **Color Consistency**: Reuse color scheme from existing charts

### Files to Modify
- `excel_exporter.py`: Add `_create_progress_sheet()` method
- `charts_helper_enhanced.py`: Add progress chart creation functions
- `main.py`: Ensure progress sheet creation in export flow
- `chart_colors.py`: Add progress state colors

---

## Success Criteria

âœ… Progress sheet created with 7 charts (3 conditional)
âœ… Charts accurately reflect story point progress
âœ… Stacked bars show Done/In Progress/To Do breakdown
âœ… Pie charts show sprint composition by epic
âœ… Charts handle edge cases (no data, 0 points)
âœ… Consistent styling with existing charts
âœ… Documentation updated
âœ… All tests passing

---

## Notes

### Chart Numbering Issue
The specification has duplicate numbering (two "4" and two "5"). The actual charts are:
1. Sprint Progress in Percentage
2. Sprint Progress in Story Points (Stacked)
3. Sprint Composition (Pie)
4. Epic Progress in Percentage
5. Epic Progress in Story Points (Stacked)
6. Open Epic Progress in Percentage (labeled as "4" in spec)
7. Open Epic Progress in Story Points (Stacked) (labeled as "5" in spec)

### Design Decisions Needed
- [ ] Should sprint charts combine all sprints or create separate charts per sprint?
- [ ] How to handle epics with 0 total story points?
- [ ] Maximum number of epics to display per chart (readability)?
- [ ] Sort order for epics (alphabetical, by completion, by story points)?
- [ ] Should we add a summary section with key metrics?

---

## Dependencies

- P-001 must be completed (provides story points, status category, parent key)
- Existing chart infrastructure (charts_helper_enhanced.py)
- openpyxl library for chart creation
- Story points data must be available and accurate

---

## Risk Assessment

**Low Risk:**
- Reusing existing chart infrastructure
- Data already available from P-001
- Similar to existing chart functionality

**Medium Risk:**
- Stacked bar charts may be complex in openpyxl
- Layout with 7 charts may require careful positioning
- Performance with large datasets (many epics)

**Mitigation:**
- Test stacked bar charts early
- Design flexible layout system
- Add pagination/filtering for large epic lists
- Implement efficient data aggregation

---

## Estimated Effort

- **Scope 1**: 1 week (3 charts, data aggregation)
- **Scope 2**: 3 days (2 charts, reuse logic)
- **Scope 3**: 3 days (2 charts, reuse logic)
- **Scope 4**: 2 days (sheet creation, layout)
- **Scope 5**: 3 days (helper functions, testing)
- **Scope 6**: 2 days (styling, consistency)
- **Scope 7**: 3 days (testing, documentation)

**Total**: ~4 weeks

---

## Next Steps

1. Review and approve plan
2. Clarify design decisions (sprint chart approach, epic sorting)
3. Start with Scope 5 (data aggregation functions)
4. Proceed to Scope 1 (sprint charts)
5. Continue with Scopes 2-3 (epic charts)
6. Complete with Scopes 4, 6, 7 (integration, styling, testing)
